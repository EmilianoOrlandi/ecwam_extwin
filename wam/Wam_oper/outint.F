      SUBROUTINE OUTINT (IU06, IU20, IU21, IU30, ITEST, KFDB, LFDBOPEN)

! ----------------------------------------------------------------------

!**** *OUTINT* - OUTPUT OF INTEGRATED FIELDS IS WRITTEN.

!     H. GUNTHER       ECMWF  JUNE     1990
!     A. GUILLAUME     ECMWF  JUNE     1992 HANDLING OF MISSING VALUES,
!                                           AND FDB OUTPUT.
!     A. GUILLAUME     ECMWF  JULY     1992 DIRECTIONS.

!     P.A.E.M. JANSSEN ECMWF  AUGUST   1995

!     J. BIDLOT        ECMWF  APRIL    1996 MESSAGE PASSING.
!     J. BIDLOT        ECMWF  OCTOBER  1997 ADD OUTPUT OF U10G.
!     B. HANSEN        ECMWF  FEBRUARY 1998 INTERFACE TO FDB.
!     P. TOWERS        ECMWF  APRIL    2003 ISETFIELDCOUNTFDB
!     P.A.E.M. JANSSEN ECMWF  JUNE     2007 ADD OUTPUT OF FREAK WAVE 
!                                           PARAMETERS.
!     P.A.E.M. JANSSEN ECMWF  MARCH    2009 ADD OUTPUT OF STOKES DRIFT 
!                                           COMPONENTS.
!     D. PETTENUZZO           MAY      2012 ADD OUTPUT of 3 WAVE TRAINS

!*    PURPOSE.
!     --------

!       OUTPUT OF WAVE AND WIND FIELDS IN GRIDDED FORMAT
!       TO DISK ,PRINTER AND FDB.


!**   INTERFACE.
!     ----------
!       *CALL* *OUTINT (IU06, IU20, IU21, IU30, ITEST, KFDB)
!          *IU06*   - PRINTER OUTPUT UNIT.
!          *IU20*   - OUTPUT UNIT OF PARAMETERS OF TOTAL SPECTRUM.
!          *IU21    - OUTPUT UNIT OF SEA AND SWELL + 3 SWELL TRAINS PARAMETERS.
!          *IU30    - OUTPUT UNIT OF GRIBBED PARAMETERS OF TOTAL
!                     SPECTRUM.
!          *ITEST*  - TESTOUTPUT GIVEN IF ITEST LT 2.
!          *KFDB*   - REFERENCE TO THE FDB DATABASE.

!     EXTERNALS.
!     ----------

!       *OUTPP*     - PRINTER OUTPUT OF AN ARRAY.
!       *GRIBPAC*   -
!       *WGRIBENOUT*
!       *MPGATHERGRDFLD* - GATHER GRID FIELD ONTO ONE PROCESS

!     METHOD.
!     -------

!       NONE.

!     REFERENCE.
!     ----------

!       NONE.

! ----------------------------------------------------------------------

      USE YOWCOUP  , ONLY : LWCOU    ,ALPHA    ,XKAPPA   ,XNLEV
      USE YOWCOUT  , ONLY : FFLAG    ,FFLAG20  ,FFLAG21  ,PFLAG    ,
     &            PFLAG20  ,PFLAG21  ,GFLAG    ,GFLAG20  ,GFLAG21  ,
     &            NTRAIN   ,JPPFLAG  ,
     &            LFDB     ,IPFGTBL  ,LOUTINT
      USE YOWGRIBHD, ONLY : NTENCODE ,HOPERI
      USE YOWGRID  , ONLY : NLONRGG  ,DELPHI
      USE YOMHOOK   ,ONLY : LHOOK,   DR_HOOK
      USE YOWINTP  , ONLY : WHGTTG   ,WDIRTG   ,WPKFTG   ,WMNFTG   ,
     &            USTARG   ,UDIRG    ,TAUWG    ,CDG      ,SMEANG   ,
     &            U10G     ,WHGTAG   ,CWHTAG   ,RANGAG   ,MWP1G    ,
     &            MWP2G    ,WSPRDG   ,C4G      ,BFG      ,QPG      ,
     &            DEPTHG   ,HMAXG    ,TMAXG    ,USTOKESG ,VSTOKESG ,
     &            UCURG    ,VCURG    ,PHIEPSG  ,PHIAWG   ,TAUOCG   ,
     &            STRNMSG  ,RHOAG    ,WSTARG   ,CICG     ,CIHG     ,
     &            C3G      ,E10G     ,
     &            NSSTG    ,NICCG    ,NICTG    ,NUCUG    ,NVCUG    ,
     &            WEFLXMG  ,WEFLXDG  ,E1012G   , 
     &            E1214G   ,E1417G   ,E1721G   ,E2125G   ,E2530G   ,
     &            WX1G     ,WX2G     ,WX3G     ,WX4G     ,WX5G
      USE YOWINTS  , ONLY : WHGTSG   ,WDIRSG   ,WMNFSG   ,WHGTWG   ,
     &            WDIRWG   ,WMNFWG   ,MWP1SG   ,MWP2SG   ,WSPRDSG  ,
     &            MWP1WG   ,MWP2WG   ,WSPRDWG
      USE YOWINTT  , ONLY : WHGTTRG  ,WDIRTRG  ,MWPMTRG
      USE YOWMAP   , ONLY : IRGG     ,AMOWEP   ,AMOSOP   ,AMOEAP   ,
     &            AMONOP   ,ZDELLO
      USE YOWMESPAS, ONLY : LMESSPASS
      USE YOWMPP   , ONLY : IRANK    ,NPROC
      USE YOWPARAM , ONLY : NGX      ,NGY      ,CLDOMAIN
      USE YOWPCONS , ONLY : G        ,DEG      ,ZMISS
      USE YOWSHAL  , ONLY : DEPTH    ,TFAK     ,INDEP
      USE YOWSTAT  , ONLY : CDATEA   ,CDATEF   ,CDTPRO   ,CDTINTT  ,
     &            CDTINTS  ,CFDBSF   ,ISHALLO  ,IASSI    ,NENSFNB  ,
     &            NTOTENS  ,MARSTYPE ,YCLASS   ,YEXPVER
      USE FDBSUBS_MOD
      USE GRIB_API_INTERFACE

! ----------------------------------------------------------------------
      IMPLICIT NONE

      INTEGER :: IU06, IU20, IU21, IU30, ITEST, KFDB
      INTEGER :: I, J, ITG
      INTEGER :: ITT, ICT, ITAG
      INTEGER :: JY, JX
      INTEGER :: IGLOBAL,ILOCAL      ! FDB field counters
      INTEGER :: IPARAM, ITABLE
      INTEGER :: IZLEV
      INTEGER :: IRECV
      INTEGER :: IERR
      INTEGER :: IUOUT 
      INTEGER :: IFCST, INHOUR, ISHIFT
      INTEGER :: IY,IM,ID,IH,IMN,ISS
  
      REAL :: DNGX,DNGY
      REAL :: ZHOOK_HANDLE

      CHARACTER(LEN=14) :: CDATE, CDATE1, CDATE2
      CHARACTER(LEN=24) :: OFILENAME
      CHARACTER(LEN=100) :: TITL

      LOGICAL :: LFDBOPEN
      LOGICAL :: FRSTIME30

      DATA FRSTIME30 / .TRUE. /

! ----------------------------------------------------------------------
!
#ifdef ECMWF
      IF (LHOOK) CALL DR_HOOK('OUTINT',0,ZHOOK_HANDLE)
#endif

      IGLOBAL=0
      ILOCAL=0
      LOUTINT=.TRUE.

      IF(CLDOMAIN.EQ.'s') THEN

        CALL OUT_ONEGRDPT(IU06)
  
      ENDIF

      IF (CDTINTT.EQ.CDTPRO) THEN

!*      0.2 CONVERT DIRECTIONS TO DEGREES AND METEOROLOGICAL CONVENTION
!           -----------------------------------------------------------

        IF(FFLAG(2).OR.PFLAG(2).OR.GFLAG(2)) THEN
          IF ((LMESSPASS.AND.(IRANK.EQ.IPFGTBL(2)))
     &     .OR.(.NOT.LMESSPASS)) THEN
            DO J=1,NGY
              DO I=1,NGX
                IF(WDIRTG(I,J).NE.ZMISS)
     &            WDIRTG(I,J) = MOD(DEG * WDIRTG(I,J) +180.,360.)
              ENDDO
            ENDDO
          ENDIF
        ENDIF

        IF(FFLAG(5).OR.PFLAG(5).OR.GFLAG(5)) THEN
          IF ((LMESSPASS.AND.(IRANK.EQ.IPFGTBL(5)))
     &     .OR.(.NOT.LMESSPASS)) THEN
            DO J=1,NGY
              DO I=1,NGX
                IF(UDIRG(I,J).NE.ZMISS)
     &            UDIRG(I,J) = MOD(DEG * UDIRG(I,J) +180.,360.)
              ENDDO
            ENDDO
          ENDIF
        ENDIF

        IF(FFLAG(69).OR.PFLAG(69).OR.GFLAG(69)) THEN
          IF ((LMESSPASS.AND.(IRANK.EQ.IPFGTBL(69)))
     &     .OR.(.NOT.LMESSPASS)) THEN
            DO J=1,NGY
              DO I=1,NGX
                IF(WEFLXDG(I,J).NE.ZMISS)
     &            WEFLXDG(I,J) = MOD(DEG * WEFLXDG(I,J) +180.,360.)
              ENDDO
            ENDDO
          ENDIF
        ENDIF

      ENDIF

      IF (CDTINTS.EQ.CDTPRO) THEN

!*      0.4 CONVERT DIRECTIONS TO DEGREES AND METEOROLOGICAL CONVENTION
!           -----------------------------------------------------------
        IF(FFLAG(14).OR.PFLAG(14).OR.GFLAG(14)) THEN
          IF ((LMESSPASS.AND.(IRANK.EQ.IPFGTBL(14)))
     &     .OR.(.NOT.LMESSPASS)) THEN
            DO J=1,NGY
              DO I=1,NGX
              IF(WDIRSG(I,J).NE.ZMISS)
     &          WDIRSG(I,J) = MOD(DEG * WDIRSG(I,J) + 180.,360.)
              ENDDO
            ENDDO
          ENDIF
        ENDIF

        IF(FFLAG(13).OR.PFLAG(13).OR.GFLAG(13)) THEN
          IF ((LMESSPASS.AND.(IRANK.EQ.IPFGTBL(13)))
     &     .OR.(.NOT.LMESSPASS)) THEN
            DO J=1,NGY
              DO I=1,NGX
                IF(WDIRWG(I,J).NE.ZMISS)
     &            WDIRWG(I,J) = MOD(DEG * WDIRWG(I,J) + 180.,360.)
              ENDDO
            ENDDO
          ENDIF
        ENDIF

        ICT=45
        DO ITT=1,NTRAIN
          ICT=ICT+3
          IF(FFLAG(ICT).OR.PFLAG(ICT).OR.GFLAG(ICT)) THEN
            IF ((LMESSPASS.AND.(IRANK.EQ.IPFGTBL(ICT)))
     &       .OR.(.NOT.LMESSPASS)) THEN
              DO J=1,NGY
                DO I=1,NGX
                  IF(WDIRTRG(I,J,ITT).NE.ZMISS)
     &              WDIRTRG(I,J,ITT) =
     &                MOD(DEG * WDIRTRG(I,J,ITT) + 180.,360.)
                ENDDO
              ENDDO
            ENDIF
          ENDIF
        ENDDO

      ENDIF


!     1. COLLECT INTEGRATED PARAMETERS FOR OUTPUT ON A SPECIFIC PROCESS
!        --------------------------------------------------------------

      IF(LMESSPASS.AND.(FFLAG20.OR.PFLAG20.OR.GFLAG20)) THEN
!       1.1 COLLECT TOTAL SEA PARAMETER ARRAYS TO PROCESS NPROC
!           ---------------------------------------------------
        IRECV=NPROC

        IF (FFLAG(1)) CALL MPGATHERGRDFLD(IPFGTBL(1),IRECV,1,WHGTTG)
        IF (FFLAG(2)) CALL MPGATHERGRDFLD(IPFGTBL(2),IRECV,2,WDIRTG)
        IF (FFLAG(3)) CALL MPGATHERGRDFLD(IPFGTBL(3),IRECV,3,WMNFTG)
        IF (FFLAG(4)) CALL MPGATHERGRDFLD(IPFGTBL(4),IRECV,4,USTARG)
        IF (FFLAG(5)) CALL MPGATHERGRDFLD(IPFGTBL(5),IRECV,5,UDIRG)
        IF (FFLAG(6)) CALL MPGATHERGRDFLD(IPFGTBL(6),IRECV,6,WPKFTG)
        IF (FFLAG(7)) CALL MPGATHERGRDFLD(IPFGTBL(7),IRECV,7,CDG)
        IF (FFLAG(8)) CALL MPGATHERGRDFLD(IPFGTBL(8),IRECV,8,TAUWG)
        IF (FFLAG(9)) CALL MPGATHERGRDFLD(IPFGTBL(9),IRECV,9,SMEANG)
        IF (FFLAG(10))CALL MPGATHERGRDFLD(IPFGTBL(10),IRECV,10,U10G)
        IF (FFLAG(22).AND.MARSTYPE.EQ.'an'.AND.IASSI.EQ.1) THEN
          IF(IRANK.EQ.IRECV .AND. .NOT.ALLOCATED(WHGTAG))
     &       ALLOCATE(WHGTAG(NGX,NGY))
          CALL MPGATHERGRDFLD(IPFGTBL(22),IRECV,22,WHGTAG)
        ENDIF
        IF (FFLAG(23).AND.MARSTYPE.EQ.'an'.AND.IASSI.EQ.1) THEN
          IF(IRANK.EQ.IRECV .AND. .NOT.ALLOCATED(CWHTAG))
     &       ALLOCATE(CWHTAG(NGX,NGY))
          CALL MPGATHERGRDFLD(IPFGTBL(23),IRECV,23,CWHTAG)
        ENDIF
        IF (FFLAG(24).AND.MARSTYPE.EQ.'an'.AND.IASSI.EQ.1) THEN
          IF(IRANK.EQ.IRECV .AND. .NOT.ALLOCATED(RANGAG))
     &       ALLOCATE(RANGAG(NGX,NGY))
          CALL MPGATHERGRDFLD(IPFGTBL(24),IRECV,24,RANGAG)
        ENDIF
        IF (FFLAG(25))CALL MPGATHERGRDFLD(IPFGTBL(25),IRECV,25,MWP1G)
        IF (FFLAG(26))CALL MPGATHERGRDFLD(IPFGTBL(26),IRECV,26,MWP2G)
        IF (FFLAG(27))CALL MPGATHERGRDFLD(IPFGTBL(27),IRECV,27,WSPRDG)
        IF (FFLAG(34))CALL MPGATHERGRDFLD(IPFGTBL(34),IRECV,34,C4G)
        IF (FFLAG(35))CALL MPGATHERGRDFLD(IPFGTBL(35),IRECV,35,BFG)
        IF (FFLAG(36))CALL MPGATHERGRDFLD(IPFGTBL(36),IRECV,36,QPG)
        IF (FFLAG(37))CALL MPGATHERGRDFLD(IPFGTBL(37),IRECV,37,DEPTHG)
        IF (FFLAG(38))CALL MPGATHERGRDFLD(IPFGTBL(38),IRECV,38,HMAXG)
        IF (FFLAG(39))CALL MPGATHERGRDFLD(IPFGTBL(39),IRECV,39,TMAXG)
        IF (FFLAG(40))CALL MPGATHERGRDFLD(IPFGTBL(40),IRECV,40,USTOKESG)
        IF (FFLAG(41))CALL MPGATHERGRDFLD(IPFGTBL(41),IRECV,41,VSTOKESG)
        IF (FFLAG(42))CALL MPGATHERGRDFLD(IPFGTBL(42),IRECV,42,UCURG)
        IF (FFLAG(43))CALL MPGATHERGRDFLD(IPFGTBL(43),IRECV,43,VCURG)
        IF (FFLAG(44))CALL MPGATHERGRDFLD(IPFGTBL(44),IRECV,44,PHIEPSG)
        IF (FFLAG(45))CALL MPGATHERGRDFLD(IPFGTBL(45),IRECV,45,PHIAWG)
        IF (FFLAG(46))CALL MPGATHERGRDFLD(IPFGTBL(46),IRECV,46,TAUOCG)

        ITG=46+3*NTRAIN+1

        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,STRNMSG)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,E10G)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,RHOAG)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,WSTARG)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,CICG)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,CIHG)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,C3G)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,NSSTG)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,NICCG)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,NICTG)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,NUCUG)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,NVCUG)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,WEFLXMG)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,WEFLXDG)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,E1012G)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,E1214G)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,E1417G)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,E1721G)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,E2125G)
        ITG=ITG+1
        IF (FFLAG(ITG))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITG,E2530G)

      ENDIF

      IF(LMESSPASS) THEN
!       1.2 COLLECT INTEGRATED PARAMETER ARRAYS TO PROCESS 1
!           ONLY FOR PRINT OUTPUT OR GRIB IF OUTPUT TO FILE
!           ------------------------------------------------
        IRECV=1

        IF (PFLAG(1).OR.(.NOT.LFDB.AND.GFLAG(1)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(1),IRECV,101,WHGTTG)
        IF (PFLAG(2).OR.(.NOT.LFDB.AND.GFLAG(2)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(2),IRECV,102,WDIRTG)
        IF (PFLAG(3).OR.(.NOT.LFDB.AND.GFLAG(3)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(3),IRECV,103,WMNFTG)
        IF (PFLAG(4).OR.(.NOT.LFDB.AND.GFLAG(4)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(4),IRECV,104,USTARG)
        IF (PFLAG(5).OR.(.NOT.LFDB.AND.GFLAG(5)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(5),IRECV,105,UDIRG)
        IF (PFLAG(6).OR.(.NOT.LFDB.AND.GFLAG(6)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(6),IRECV,106,WPKFTG)
        IF (PFLAG(7).OR.(.NOT.LFDB.AND.GFLAG(7)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(7),IRECV,107,CDG)
        IF (PFLAG(8).OR.(.NOT.LFDB.AND.GFLAG(8)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(8),IRECV,108,TAUWG)
        IF (PFLAG(9).OR.(.NOT.LFDB.AND.GFLAG(9)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(9),IRECV,109,SMEANG)
        IF (PFLAG(10).OR.(.NOT.LFDB.AND.GFLAG(10)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(10),IRECV,110,U10G)
        IF (PFLAG(11).OR.(.NOT.LFDB.AND.GFLAG(11)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(11),IRECV,111,WHGTWG)
        IF (PFLAG(12).OR.(.NOT.LFDB.AND.GFLAG(12)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(12),IRECV,112,WHGTSG)
        IF (PFLAG(13).OR.(.NOT.LFDB.AND.GFLAG(13)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(13),IRECV,113,WDIRWG)
        IF (PFLAG(14).OR.(.NOT.LFDB.AND.GFLAG(14)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(14),IRECV,114,WDIRSG)
        IF (PFLAG(15).OR.(.NOT.LFDB.AND.GFLAG(15)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(15),IRECV,115,WMNFWG)
        IF (PFLAG(16).OR.(.NOT.LFDB.AND.GFLAG(16)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(16),IRECV,116,WMNFSG)
        IF (MARSTYPE.EQ.'an'.AND.IASSI.EQ.1 .AND.
     &      (PFLAG(22).OR.(.NOT.LFDB.AND.GFLAG(22))) ) THEN
          IF(IRANK.EQ.IRECV .AND. .NOT.ALLOCATED(WHGTAG))
     &      ALLOCATE(WHGTAG(NGX,NGY))
            CALL MPGATHERGRDFLD(IPFGTBL(22),IRECV,122,WHGTAG)
        ENDIF
        IF (MARSTYPE.EQ.'an'.AND.IASSI.EQ.1 .AND.
     &      (PFLAG(23).OR.(.NOT.LFDB.AND.GFLAG(23))) ) THEN
          IF(IRANK.EQ.IRECV .AND. .NOT.ALLOCATED(CWHTAG))
     &       ALLOCATE(CWHTAG(NGX,NGY))
          CALL MPGATHERGRDFLD(IPFGTBL(23),IRECV,123,CWHTAG)
        ENDIF
        IF (MARSTYPE.EQ.'an'.AND.IASSI.EQ.1 .AND.
     &      (PFLAG(24).OR.(.NOT.LFDB.AND.GFLAG(24))) ) THEN
          IF(IRANK.EQ.IRECV .AND. .NOT.ALLOCATED(RANGAG))
     &       ALLOCATE(RANGAG(NGX,NGY))
          CALL MPGATHERGRDFLD(IPFGTBL(24),IRECV,124,RANGAG)
        ENDIF
        IF (PFLAG(25).OR.(.NOT.LFDB.AND.GFLAG(25)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(25),IRECV,125,MWP1G)
        IF (PFLAG(26).OR.(.NOT.LFDB.AND.GFLAG(26)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(26),IRECV,126,MWP2G)
        IF (PFLAG(27).OR.(.NOT.LFDB.AND.GFLAG(27)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(27),IRECV,127,WSPRDG)
        IF (PFLAG(28).OR.(.NOT.LFDB.AND.GFLAG(28)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(28),IRECV,128,MWP1WG)
        IF (PFLAG(29).OR.(.NOT.LFDB.AND.GFLAG(29)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(29),IRECV,129,MWP1SG)
        IF (PFLAG(30).OR.(.NOT.LFDB.AND.GFLAG(30)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(30),IRECV,130,MWP2WG)
        IF (PFLAG(31).OR.(.NOT.LFDB.AND.GFLAG(31)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(31),IRECV,131,MWP2SG)
        IF (PFLAG(32).OR.(.NOT.LFDB.AND.GFLAG(32)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(32),IRECV,132,WSPRDWG)
        IF (PFLAG(33).OR.(.NOT.LFDB.AND.GFLAG(33)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(33),IRECV,133,WSPRDSG)
        IF (PFLAG(34).OR.(.NOT.LFDB.AND.GFLAG(34)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(34),IRECV,134,C4G)
        IF (PFLAG(35).OR.(.NOT.LFDB.AND.GFLAG(35)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(35),IRECV,135,BFG)
        IF (PFLAG(36).OR.(.NOT.LFDB.AND.GFLAG(36)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(36),IRECV,136,QPG)
        IF (PFLAG(37).OR.(.NOT.LFDB.AND.GFLAG(37)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(37),IRECV,137,DEPTHG)
        IF (PFLAG(38).OR.(.NOT.LFDB.AND.GFLAG(38)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(38),IRECV,138,HMAXG)
        IF (PFLAG(39).OR.(.NOT.LFDB.AND.GFLAG(39)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(39),IRECV,139,TMAXG)
        IF (PFLAG(40).OR.(.NOT.LFDB.AND.GFLAG(40)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(40),IRECV,140,USTOKESG)
        IF (PFLAG(41).OR.(.NOT.LFDB.AND.GFLAG(41)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(41),IRECV,141,VSTOKESG)
        IF (PFLAG(42).OR.(.NOT.LFDB.AND.GFLAG(42)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(42),IRECV,142,UCURG)
        IF (PFLAG(43).OR.(.NOT.LFDB.AND.GFLAG(43)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(43),IRECV,143,VCURG)
        IF (PFLAG(44).OR.(.NOT.LFDB.AND.GFLAG(44)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(44),IRECV,144,PHIEPSG)
        IF (PFLAG(45).OR.(.NOT.LFDB.AND.GFLAG(45)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(45),IRECV,145,PHIAWG)
        IF (PFLAG(46).OR.(.NOT.LFDB.AND.GFLAG(46)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(46),IRECV,146,TAUOCG)
        ICT=46
        DO ITT=1,NTRAIN
          ICT=ICT+1
          ITAG=100+ICT
          IF (PFLAG(ICT).OR.(.NOT.LFDB.AND.GFLAG(ICT)))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ICT),IRECV,ITAG,WHGTTRG(:,:,ITT))
          ICT=ICT+1
          IF (PFLAG(ICT).OR.(.NOT.LFDB.AND.GFLAG(ICT)))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ICT),IRECV,ITAG,WDIRTRG(:,:,ITT))
          ICT=ICT+1
          IF (PFLAG(ICT).OR.(.NOT.LFDB.AND.GFLAG(ICT)))
     &    CALL MPGATHERGRDFLD(IPFGTBL(ICT),IRECV,ITAG,MWPMTRG(:,:,ITT))
        ENDDO

        ITG=46+3*NTRAIN+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,STRNMSG)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,E10G)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,RHOAG)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,WSTARG)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,CICG)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,CIHG)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,C3G)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,NSSTG)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,NICCG)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,NICTG)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,NUCUG)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,NVCUG)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,WEFLXMG)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,WEFLXDG)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,E1012G)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,E1214G)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,E1417G)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,E1721G)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,E2125G)
        ITG=ITG+1
        ITAG=100+ITG
        IF (PFLAG(ITG).OR.(.NOT.LFDB.AND.GFLAG(ITG)))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ITG),IRECV,ITAG,E2530G)

      ENDIF

      IF(LMESSPASS.AND.(FFLAG21.OR.PFLAG21.OR.GFLAG21)) THEN
!       1.3 COLLECT SWELL, WIND SEA AND SWELL TRAINS PARAMETER ARRAYS TO PROCESS IRECV
!           ----------------------------------------------------------------------
        IRECV=MIN(2,NPROC)

        IF (FFLAG(11)) CALL MPGATHERGRDFLD(IPFGTBL(11),IRECV,11,WHGTWG)
        IF (FFLAG(12)) CALL MPGATHERGRDFLD(IPFGTBL(12),IRECV,12,WHGTSG)
        IF (FFLAG(13)) CALL MPGATHERGRDFLD(IPFGTBL(13),IRECV,13,WDIRWG)
        IF (FFLAG(14)) CALL MPGATHERGRDFLD(IPFGTBL(14),IRECV,14,WDIRSG)
        IF (FFLAG(15)) CALL MPGATHERGRDFLD(IPFGTBL(15),IRECV,15,WMNFWG)
        IF (FFLAG(16)) CALL MPGATHERGRDFLD(IPFGTBL(16),IRECV,16,WMNFSG)
        IF (FFLAG(28)) CALL MPGATHERGRDFLD(IPFGTBL(28),IRECV,28,MWP1WG)
        IF (FFLAG(29)) CALL MPGATHERGRDFLD(IPFGTBL(29),IRECV,29,MWP1SG)
        IF (FFLAG(30)) CALL MPGATHERGRDFLD(IPFGTBL(30),IRECV,30,MWP2WG)
        IF (FFLAG(31)) CALL MPGATHERGRDFLD(IPFGTBL(31),IRECV,31,MWP2SG)
        IF (FFLAG(32)) CALL MPGATHERGRDFLD(IPFGTBL(32),IRECV,32,WSPRDWG)
        IF (FFLAG(33)) CALL MPGATHERGRDFLD(IPFGTBL(33),IRECV,33,WSPRDSG)

        ICT=46
        DO ITT=1,NTRAIN
          ICT=ICT+1
          IF (FFLAG(ICT))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ICT),IRECV,ICT,WHGTTRG(:,:,ITT))
          ICT=ICT+1
          IF (FFLAG(ICT))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ICT),IRECV,ICT,WDIRTRG(:,:,ITT))
          ICT=ICT+1
          IF (FFLAG(ICT))
     &      CALL MPGATHERGRDFLD(IPFGTBL(ICT),IRECV,ICT,MWPMTRG(:,:,ITT))
        ENDDO

      ENDIF


!*    2. OUTPUT OF INTEGRATED PARAMETERS OF TOTAL SEA.
!        ---------------------------------------------

      IF (CDTINTT.EQ.CDTPRO) THEN

!*      2.1 WRITE PARAMETERS OF TOTAL SEA AND WIND TO FILE.
!           -----------------------------------------------

        IF(FFLAG20) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.NPROC)).OR.(.NOT.LMESSPASS)) THEN

            DNGX = REAL(NGX)
            DNGY = REAL(NGY)

            WRITE (IU20) CDTPRO, DNGX, DNGY, AMOWEP,AMOSOP,AMOEAP,
     &                   AMONOP, ZDELLO
            WRITE (IU20) JPPFLAG
            WRITE (IU20) (FFLAG(J),J=1,JPPFLAG)
            IF (FFLAG(1)) WRITE (IU20) WHGTTG
            IF (FFLAG(2)) WRITE (IU20) WDIRTG
            IF (FFLAG(3)) WRITE (IU20) WMNFTG
            IF (FFLAG(4)) WRITE (IU20) USTARG
            IF (FFLAG(5)) WRITE (IU20) UDIRG
            IF (FFLAG(6)) WRITE (IU20) WPKFTG
            IF (FFLAG(7)) WRITE (IU20) CDG
            IF (FFLAG(8)) WRITE (IU20) TAUWG
            IF (FFLAG(9)) WRITE (IU20) SMEANG
            IF (FFLAG(10))WRITE (IU20) U10G
            IF (FFLAG(22).AND.MARSTYPE.EQ.'an'.AND.IASSI.EQ.1)
     &          WRITE (IU20) WHGTAG
            IF (FFLAG(23).AND.MARSTYPE.EQ.'an'.AND.IASSI.EQ.1)
     &          WRITE (IU20) CWHTAG
            IF (FFLAG(24).AND.MARSTYPE.EQ.'an'.AND.IASSI.EQ.1)
     &          WRITE (IU20) RANGAG
            IF (FFLAG(25))WRITE (IU20) MWP1G
            IF (FFLAG(26))WRITE (IU20) MWP2G
            IF (FFLAG(27))WRITE (IU20) WSPRDG
            IF (FFLAG(34))WRITE (IU20) C4G
            IF (FFLAG(35))WRITE (IU20) BFG
            IF (FFLAG(36))WRITE (IU20) QPG
            IF (FFLAG(37))WRITE (IU20) DEPTHG
            IF (FFLAG(38))WRITE (IU20) HMAXG
            IF (FFLAG(39))WRITE (IU20) TMAXG
            IF (FFLAG(40))WRITE (IU20) USTOKESG
            IF (FFLAG(41))WRITE (IU20) VSTOKESG
            IF (FFLAG(42))WRITE (IU20) UCURG
            IF (FFLAG(43))WRITE (IU20) VCURG
            IF (FFLAG(44))WRITE (IU20) PHIEPSG
            IF (FFLAG(45))WRITE (IU20) PHIAWG
            IF (FFLAG(46))WRITE (IU20) TAUOCG
            ITG=46+3*NTRAIN+1
            IF (FFLAG(ITG))WRITE (IU20) STRNMSG
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) E10G 
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) RHOAG 
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) WSTARG
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) CICG
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) CIHG
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) C3G
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) NSSTG
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) NICCG
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) NICTG
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) NUCUG
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) NVCUG
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) WEFLXMG 
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) WEFLXDG
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) E1012G
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) E1214G
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) E1417G
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) E1721G
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) E2125G
            ITG=ITG+1
            IF (FFLAG(ITG))WRITE (IU20) E2530G 
          ENDIF
        ENDIF

!*      2.2 PRINT PARAMETERS OF TOTAL SEA AND WIND.
!           ---------------------------------------

        IF(CLDOMAIN.NE.'s') THEN
        IF (PFLAG(1)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' SIGNIFICANT WAVE HEIGHT ( 0.1 METRES )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &                 WHGTTG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(2)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN WAVE DIRECTION ( DEGREE FROM NORTH TO )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 WDIRTG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(3)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN WAVE FREQUENCY ( 0.01 HERTZ )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 WMNFTG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(4)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' FRICTION VELOCITY ( 0.01 METRES/SECOND )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 USTARG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(5)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' FRICTION DIRECTION ( DEGREE FROM NORTH TO )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 UDIRG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(6)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' PEAK WAVE FREQUENCY ( 0.01 HERTZ )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 WPKFTG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(7)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' DRAG COEFFICIENT (IN  0.1 *PROMILLE )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10000.,
     &                 CDG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(8)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' NORMALISED WAVE STRESS (IN % )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 TAUWG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(9)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN SQUARE SLOPE (IN % )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 SMEANG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(10)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' WIND SPEED ( METRES/SECOND )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 U10G, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(22).AND.MARSTYPE.EQ.'an'.AND.IASSI.EQ.1) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' ALTIMETER WAVE HEIGHT ( 0.1 METRES )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &                 WHGTAG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(23).AND.MARSTYPE.EQ.'an'.AND.IASSI.EQ.1) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' CORRECTED ALTIMETER WAVE HEIGHT (0.1 METRES)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &                 CWHTAG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(24).AND.MARSTYPE.EQ.'an'.AND.IASSI.EQ.1) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' ALTIMETER RANGE RELATIVE CORRECTION (1000)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 0.001,
     &                 RANGAG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(25)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN PERIOD (1) ( SECOND )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 MWP1G, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(26)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN PERIOD (2) ( SECOND )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 MWP2G, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(27)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN DIRECTIONAL SPREAD (x 0.01)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 WSPRDG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(34)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' SPECTRAL KURTOSIS (x10)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &                 C4G, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(35)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' BENJAMIN-FEIR INDEX (x10)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &                 BFG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(36)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' SPECTRAL PEAKEDNESS (0.1 Hz)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &                 QPG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF

        IF (PFLAG(37)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MODEL BATHYMETRY (m)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 DEPTHG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(38)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MAXIMUM WAVE HEIGHT ( 0.1 METRES )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &                 HMAXG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(39)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MAX WAVE PERIOD ( SECOND )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 TMAXG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(40)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' U-COMP STOKES DRIFT ( 0.01 M/S )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 USTOKESG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(41)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' V-COMP STOKES DRIFT ( 0.01 M/S )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 VSTOKESG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(42)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' U-COMP SURFACE CURRENT ( 0.01 M/S )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 UCURG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(43)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' V-COMP SURFACE CURRENT ( 0.01 M/S )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 VCURG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(44)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' NORMALIZED ENERGY FLUX TO OCEAN'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 PHIEPSG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(45)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' NORMALIZED ENERGY FLUX TO WAVES'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 PHIAWG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(46)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' NORMALIZED MOMENTUM FLUX TO OCEAN'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 TAUOCG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=46+3*NTRAIN+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN SQUARE WAVE STRAIN IN THE SEA ICE'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY,NGX,NGY,TITL,100000000.,
     &                 STRNMSG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' H10 (0.1 METERS)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY,NGX,NGY,TITL,10.,
     &                 E10G, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' AIR DENSITY'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY,NGX,NGY,TITL,10.,
     &                 RHOAG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' CONVECTIVE VELOCITY SCALE'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY,NGX,NGY,TITL,10.,
     &                 WSTARG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' SEA ICE COVER'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY,NGX,NGY,TITL,100.,
     &                 CICG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' SEA ICE THICKNESS'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY,NGX,NGY,TITL,100.,
     &                 CIHG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' SPECTRAL SKWENESS'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY,NGX,NGY,TITL,1.,
     &                 C3G, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' SST FROM NEMO'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 NSSTG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' ICE COVER FROM NEMO'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 NICCG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' ICE THICKNESS FROM NEMO'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 NICTG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' U-CURRENT FROM NEMO'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 NUCUG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' V-CURRENT FROM NEMO'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 NVCUG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' WAVE ENERGY FLUX MAGNITUDE'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 WEFLXMG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' WAVE ENERGY FLUX DIRECTION'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 WEFLXDG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' H1012 (0.01 METERS)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 E1012G, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' H1214 (0.01 METERS)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 E1214G, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' H1417 (0.01 METERS)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 E1417G, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' H1721 (0.01 METERS)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 E1721G, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' H2125 (0.01 METERS)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 E2125G, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        ITG=ITG+1
        IF (PFLAG(ITG)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' H2530 (0.01 METERS)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 E2530G, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF

        ENDIF
      ENDIF

! ----------------------------------------------------------------------

!*    3. OUTPUT OF INTEGRATED PARAMETERS OF SEA, SWELL AND SWELL TRAINS.
!        -----------------------------------------------------------

      IF (CDTINTS.EQ.CDTPRO) THEN

!*      3.1 WRITE PARAMETERS OF SWELL, WIND DIRECTION AND SWELL TRAINS TO FILE.
!           ---------------------------------------------------------------

        IF(FFLAG21) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.MIN(2,NPROC)))
     &     .OR.(.NOT.LMESSPASS)) THEN

            DNGX = REAL(NGX)
            DNGY = REAL(NGY)

            WRITE (IU21) CDTPRO, DNGX, DNGY, AMOWEP,AMOSOP,AMOEAP,
     &                   AMONOP, ZDELLO
            WRITE (IU21) JPPFLAG
            WRITE (IU21) (FFLAG(J),J=1,JPPFLAG)
            IF (FFLAG(11)) WRITE (IU21) WHGTWG
            IF (FFLAG(13)) WRITE (IU21) WDIRWG
            IF (FFLAG(15)) WRITE (IU21) WMNFWG
            IF (FFLAG(12)) WRITE (IU21) WHGTSG
            IF (FFLAG(14)) WRITE (IU21) WDIRSG
            IF (FFLAG(16)) WRITE (IU21) WMNFSG
            IF (FFLAG(28)) WRITE (IU21) MWP1WG
            IF (FFLAG(29)) WRITE (IU21) MWP1SG
            IF (FFLAG(30)) WRITE (IU21) MWP2WG
            IF (FFLAG(31)) WRITE (IU21) MWP2SG
            IF (FFLAG(32)) WRITE (IU21) WSPRDWG
            IF (FFLAG(33)) WRITE (IU21) WSPRDSG

            ICT=46
            DO ITT=1,NTRAIN
              ICT=ICT+1
              IF (FFLAG(ICT)) WRITE (IU21) WHGTTRG(:,:,ITT)
              ICT=ICT+1
              IF (FFLAG(ICT)) WRITE (IU21) WDIRTRG(:,:,ITT)
              ICT=ICT+1
              IF (FFLAG(ICT)) WRITE (IU21) MWPMTRG(:,:,ITT)
            ENDDO
          ENDIF
        ENDIF


!*      3.2 PRINT PARAMETERS OF SWELL AND WIND WAVE DIRECTION.
!           --------------------------------------------------

        IF(CLDOMAIN.NE.'s') THEN

        IF (PFLAG(11)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' WIND SEA WAVE HEIGHT ( 0.1 METRES )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &                 WHGTWG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(13)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN WIND SEA DIRECTION ( DEGREE FROM NORTH FROM )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 WDIRWG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(15)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN WIND SEA FREQUENCY ( 0.01 HERTZ )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 WMNFWG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(12)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' SWELL WAVE HEIGHT ( 0.1 METRES )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &                 WHGTSG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(14)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN SWELL DIRECTION ( DEGREE FROM NORTH FROM )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &                 WDIRSG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(16)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN SWELL FREQUENCY ( 0.01 HERTZ )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 WMNFSG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(28)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN WIND SEA PERIOD (1) ( 0.1 SECOND )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &                 MWP1WG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(29)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN SWELL PERIOD (1) ( 0.1 SECOND )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &                 MWP1SG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(30)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN WIND SEA PERIOD (2) ( 0.1 SECOND )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &                 MWP2WG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(31)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN SWELL PERIOD (2) ( 0.1 SECOND )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &                 MWP2SG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(32)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN WIND SEA DIRECTIONAL SPREAD (x 0.01)'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 WSPRDWG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF
        IF (PFLAG(33)) THEN
          IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
            TITL = ' MEAN SWELL DIRECTIONAL SPREAD (x 0.01 )'
            CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 100.,
     &                 WSPRDSG, AMOWEP, AMOSOP, AMOEAP, AMONOP)
          ENDIF
        ENDIF

        ICT=46
        DO ITT=1,NTRAIN
          ICT=ICT+1
          IF (PFLAG(ICT)) THEN
            IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
              TITL = ' SWELL TRAIN WAVE HEIGHT  ( 0.1 METRES )'
              CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &               WHGTTRG(:,:,ITT), AMOWEP, AMOSOP, AMOEAP, AMONOP)
            ENDIF
          ENDIF
          ICT=ICT+1
          IF (PFLAG(ICT)) THEN
            IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
              TITL = ' SWELL TRAIN MEAN DIRECTION  ( DEGREE FROM NORTH)'
              CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 1.,
     &               WDIRTRG(:,:,ITT), AMOWEP, AMOSOP, AMOEAP, AMONOP)
            ENDIF
          ENDIF
          ICT=ICT+1
          IF (PFLAG(ICT)) THEN
            IF((LMESSPASS.AND.(IRANK.EQ.1)).OR.(.NOT.LMESSPASS)) THEN
              TITL = ' SWELL MEAN TRAIN PERIOD (1) ( 0.1 SECOND )'
              CALL OUTPP (CDTPRO, IU06, NGX, NGY, NGX, NGY, TITL, 10.,
     &               MWPMTRG(:,:,ITT), AMOWEP, AMOSOP, AMOEAP, AMONOP)
            ENDIF
          ENDIF
        ENDDO

        ENDIF ! CLDOMAIN
      ENDIF

! ----------------------------------------------------------------------

!*    4.  PACK INTEGRATED PARAMETERS INTO GRIB FM94.
!         ------------------------------------------
      IF(MARSTYPE.EQ.'4v') THEN
!*      THIS IS A 4V CASE
        CDATE=CDATEA
        READ(CDATEA,'(I4,5I2)')IY,IM,ID,IH,IMN,ISS
        CALL DIFDATE(CDATEA,CDTPRO,IFCST)
        IFCST=IFCST/3600
      ELSEIF(CDTPRO.LE.CDATEF) THEN
!*      THIS IS AN ANALYSIS DATE
        CDATE=CDTPRO
        READ(CDTPRO,'(I4,5I2)') IY,IM,ID,IH,IMN,ISS
        IFCST = 0
      ELSE
!*      THIS IS A  FORECAST DATE
        CDATE=CDATEF
        READ(CDATEF,'(I4,5I2)')IY,IM,ID,IH,IMN,ISS
!       FIND THE STEP IN HOURS ! 
        CDATE1=CDATEF
        CDATE2=CDATE1(1:8)//'010000'
!       MORE THAN A YEAR IN SECONDS 366*24*3600=31622400
        CALL INCDATE(CDATE2,31622400) 
        CDATE2=CDATE2(1:8)//'010000'
        INHOUR=0
!       FIND THE NUMBER OF FULL YEARS AND CONVERT THEM IN HOURS
        DO WHILE (CDATE2.LT.CDTPRO)
          CALL DIFDATE(CDATE1,CDATE2,ISHIFT)
          INHOUR=INHOUR+ISHIFT/3600
          CDATE1=CDATE2
          CDATE2=CDATE1(1:8)//'010000'
          CALL INCDATE(CDATE2,31622400) 
          CDATE2=CDATE2(1:8)//'010000'
        ENDDO
        CALL DIFDATE(CDATE1,CDTPRO,IFCST)
        IF(MOD(IFCST,3600) == 0 ) THEN
          IFCST=IFCST/3600
        ELSE
          WRITE(IU06,*) ' ------------------------------------------'
          WRITE(IU06,*) ' ERROR in routine OUTINT :'
          WRITE(IU06,*) ' forecast step must be a multiple of hours!'
          WRITE(IU06,*) ' IFCST =', IFCST
          WRITE(IU06,*) ' CDATEF=', CDATEF 
          WRITE(IU06,*) ' CDATE1=', CDATE1 
          WRITE(IU06,*) ' CDTPRO=', CDTPRO 
          WRITE(IU06,*) ' INHOUR=', INHOUR 
          WRITE(IU06,*) ' ------------------------------------------'
          CALL ABORT1
        ENDIF
        IFCST=INHOUR+IFCST

      ENDIF


!     OUTPUT FILE FOR GRIB DATA (if not written to FDB)

      IF(.NOT.LFDB) THEN
        IF (GFLAG20 .OR. GFLAG21) THEN
          WRITE(OFILENAME,'(A,I2)') 'fort.',IU30
          IF (FRSTIME30) THEN
            CALL IGRIB_OPEN_FILE(IUOUT,OFILENAME,'w')
            FRSTIME30=.FALSE.
          ELSE
            CALL IGRIB_OPEN_FILE(IUOUT,OFILENAME,'a')
          ENDIF
        ENDIF
      ELSE
        IUOUT=0
      ENDIF

      IF (GFLAG20.AND.CDTINTT.EQ.CDTPRO) THEN

!*      WAVE HEIGHTS.
!       -------------

        IF (GFLAG(1)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(1)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=229
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WHGTTG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      WAVE DIRECTION.
!       ---------------

        IF (GFLAG(2)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(2)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=230
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WDIRTG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      WAVE MEAN PERIOD.
!       -----------------

        IF (GFLAG(3)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(3)))
     &      .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &      .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            DO JY=1,NGY
              DO JX=1,NGX
                IF(WMNFTG(JX,JY).NE.0.)THEN
                  IF(WMNFTG(JX,JY).NE.ZMISS)THEN
                    WMNFTG(JX,JY)=1./WMNFTG(JX,JY)
                  ELSE
                    WMNFTG(JX,JY)=ZMISS
                  ENDIF
                ELSE
                  WMNFTG(JX,JY)=0.
                ENDIF
              ENDDO
            ENDDO
            IPARAM=232
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WMNFTG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      WIND DIRECTION.
!       ---------------

        IF (GFLAG(5)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(5)))
     &      .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &      .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IZLEV=NINT(XNLEV(1))
            IPARAM=249
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, UDIRG,
     &                    ITABLE, IPARAM, IZLEV, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      WAVE PEAK PERIOD.
!       -----------------

        IF (GFLAG(6)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(6)))
     &      .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &      .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=231
            ITABLE=140
            DO JY=1,NGY
              DO JX=1,NGX
                IF(WPKFTG(JX,JY).NE.0.)THEN
                  IF(WPKFTG(JX,JY).NE.ZMISS)THEN
                    WPKFTG(JX,JY)=1./WPKFTG(JX,JY)
                  ELSE
                    WPKFTG(JX,JY)=ZMISS
                  ENDIF
                ELSE
                  WPKFTG(JX,JY)=0.
                ENDIF
              ENDDO
            ENDDO
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WPKFTG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      DRAG COEFFICIENT
!       ----------------

        IF (GFLAG(7)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(7)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=233
            ITABLE=140
            IZLEV=NINT(XNLEV(1))
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, CDG,
     &                    ITABLE, IPARAM, IZLEV, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      MEAN SQUARE SLOPE.
!       ------------------

        IF (GFLAG(9)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(9)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=244
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, SMEANG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      WIND SPEED.
!       ----------

        IF (GFLAG(10)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(10)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=245
            ITABLE=140
            IZLEV=NINT(XNLEV(1))
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, U10G,
     &                    ITABLE, IPARAM, IZLEV, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      ALTIMETER WAVE HEIGHT.
!       ---------------------

        IF (GFLAG(22).AND.MARSTYPE.EQ.'an'.AND.IASSI.EQ.1) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(22)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=246
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WHGTAG,
     &                      ITABLE, IPARAM, 0, 0 , 0,
     &                      CDATE, IFCST, MARSTYPE,
     &                      LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      CORRECTED ALTIMETER WAVE HEIGHT
!       -------------------------------

        IF (GFLAG(23).AND.MARSTYPE.EQ.'an'.AND.IASSI.EQ.1) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(23)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=247
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, CWHTAG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      ALTIMETER RANGE RELATIVE CORRECTION.
!       -----------------------------------

        IF (GFLAG(24).AND.MARSTYPE.EQ.'an'.AND.IASSI.EQ.1) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(24)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=248
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, RANGAG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      MEAN PERIOD 1.
!       -------------

        IF (GFLAG(25)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(25)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=220
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, MWP1G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      MEAN PERIOD 2.
!       -------------

        IF (GFLAG(26)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(26)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=221
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, MWP2G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      MEAN DIRECTIONAL SPREAD.
!       -----------------------

        IF (GFLAG(27)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(27)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=222
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WSPRDG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      SPECTRAL KURTOSIS.
!       ------------------

        IF (GFLAG(34)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(34)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=252
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, C4G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      BENJAMIN-FEIR INDEX.
!       --------------------

        IF (GFLAG(35)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(35)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=253
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, BFG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      PEAKEDNESS FACTOR.
!       -----------------

        IF (GFLAG(36)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(36)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=254
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, QPG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      MODEL BATHYMETRY.
!       -----------------

        IF (GFLAG(37)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(37)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=219
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, DEPTHG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      MAXIMUM WAVE HEIGHT.
!       -------------------

        IF (GFLAG(38)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(38)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=218
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, HMAXG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      MAXIMUM WAVE PERIOD.
!       -------------------

        IF (GFLAG(39)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(39)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=217
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, TMAXG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      U-COMP STOKES DRIFT.
!       -------------------

        IF (GFLAG(40)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(40)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=215
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, USTOKESG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      V-COMP STOKES DRIFT.
!       -------------------

        IF (GFLAG(41)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(41)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=216
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, VSTOKESG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      U-COMP SURFACE CUIRRENT.
!       ------------------------

        IF (GFLAG(42)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(42)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=131
            ITABLE=151
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, UCURG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      V-COMP SURFACE CUIRRENT.
!       ------------------------

        IF (GFLAG(43)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(43)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=132
            ITABLE=151
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, VCURG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      NORMALIZED ENERGY FLUX TO OCEAN.
!       -------------------------------

        IF (GFLAG(44)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(44)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=212
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, PHIEPSG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      NORMALIZED ENERGY FLUX TO WAVES.
!       -------------------------------

        IF (GFLAG(45)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(45)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=211
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, PHIAWG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      NORMALIZED MOMENTUM FLUX TO OCEAN.
!       ----------------------------------

        IF (GFLAG(46)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(46)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=214
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, TAUOCG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      MEAN SQUARE WAVE STRAIN INTO THE SEA ICE 
!       ----------------------------------------

        ITG=46+3*NTRAIN+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=210
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, STRNMSG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      WAVE HEIGHT FOR ALL WAVES WITH PERIOD LARGER THAN 10S. 
!       ------------------------------------------------------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=120
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, E10G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      SURFACE AIR DENSITY 
!       -------------------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=209
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, RHOAG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      CONVECTVE VELOCITY SCALING 
!       --------------------------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=208
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WSTARG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF


!*      SEA ICE COVER
!       -------------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=31
            ITABLE=128
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, CICG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      SEA ICE THICKNESS 
!       -----------------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=92
            ITABLE=3
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, CIHG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      SPECTRAL SKEWNESS
!       -----------------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=207
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, C3G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      NEMO SST.
!       ---------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=159
            ITABLE=151
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, NSSTG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      NEMO ICE COVER.
!       ---------------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=91
            ITABLE=3
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, NICCG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      NEMO ICE THICKNESS.
!       -------------------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=92
            ITABLE=3
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, NICTG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      NEMO U-CURRENT.
!       ---------------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=49
            ITABLE=3
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, NUCUG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      NEMO V-CURRENT.
!       ---------------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=50
            ITABLE=3
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, NVCUG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      WAVE ENERGY FLUX MAGITUDE.
!       --------------------------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=112
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WEFLXMG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      WAVE ENERGY FLUX DIRECTION.
!       --------------------------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=113
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WEFLXDG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      H1012.
!       ------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=114
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, E1012G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      H1214.
!       ------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=115
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, E1214G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      H1417.
!       ------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=116
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, E1417G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      H1721.
!       ------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=117
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, E1721G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      H2125.
!       ------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=118
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, E2125G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      H2530.
!       ------

        ITG=ITG+1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=119
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, E2530G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      EXTRA FIELD 1
!       -------------

        ITG=JPPFLAG-4
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=080
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WX1G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      EXTRA FIELD 2
!       -------------

        ITG=JPPFLAG-3
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=081
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WX2G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      EXTRA FIELD 3
!       -------------

        ITG=JPPFLAG-2
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=082
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WX3G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      EXTRA FIELD 4
!       -------------

        ITG=JPPFLAG-1
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=083
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WX4G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      EXTRA FIELD 5
!       -------------

        ITG=JPPFLAG
        IF (GFLAG(ITG)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=084
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WX5G,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

      ENDIF


! ----------------------------------------------------------------------

!*    5.  PACK WIND SEA AND SWELL PARAMETERS INTO GRIB FM94.
!         -------------------------------------------------

      IF (GFLAG21.AND.CDTINTS.EQ.CDTPRO) THEN

!*      WIND SEA WAVE HEIGHTS.
!       ---------------------

        IF (GFLAG(11)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(11)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=234
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WHGTWG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      WIND SEA WAVE DIRECTION.
!       ------------------------


        IF (GFLAG(13)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(13)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=235
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WDIRWG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      WIND SEA MEAN PERIOD.
!       --------------------

        IF (GFLAG(15)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(15)))
     &      .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &      .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=236
            ITABLE=140
            DO JY=1,NGY
              DO JX=1,NGX
                IF(WMNFWG(JX,JY).NE.0.)THEN
                  IF(WMNFWG(JX,JY).NE.ZMISS)THEN
                    WMNFWG(JX,JY)=1./WMNFWG(JX,JY)
                  ELSE
                    WMNFWG(JX,JY)=ZMISS
                  ENDIF
                ELSE
                  WMNFWG(JX,JY)=0.
                ENDIF
              ENDDO
            ENDDO
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WMNFWG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      SWELL WAVE HEIGHTS.
!       -------------------

        IF (GFLAG(12)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(12)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=237
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WHGTSG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      SWELL WAVE DIRECTION.
!       --------------------


        IF (GFLAG(14)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(14)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=238
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WDIRSG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      SWELL SEA MEAN PERIOD.
!       ---------------------

        IF (GFLAG(16)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(16)))
     &      .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &      .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=239
            ITABLE=140
            DO JY=1,NGY
              DO JX=1,NGX
                IF(WMNFSG(JX,JY).NE.0.)THEN
                  IF(WMNFSG(JX,JY).NE.ZMISS)THEN
                    WMNFSG(JX,JY)=1./WMNFSG(JX,JY)
                  ELSE
                    WMNFSG(JX,JY)=ZMISS
                  ENDIF
                ELSE
                  WMNFSG(JX,JY)=0.
                ENDIF
              ENDDO
            ENDDO
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WMNFSG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      MEAN WIND SEA PERIOD 1.
!       -----------------------

        IF (GFLAG(28)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(28)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=223
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, MWP1WG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      MEAN WIND SEA PERIOD 2.
!       -----------------------

        IF (GFLAG(30)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(30)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=224
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, MWP2WG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      MEAN WIND SEA DIRECTIONAL SPREAD.
!       ---------------------------------

        IF (GFLAG(32)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(32)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=225
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WSPRDWG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

      ENDIF

!*      MEAN SWELL PERIOD 1.
!       --------------------

        IF (GFLAG(29)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(29)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=226
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, MWP1SG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      MEAN SWELL PERIOD 2.
!       --------------------

        IF (GFLAG(31)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(31)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=227
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, MWP2SG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF

!*      MEAN SWELL DIRECTIONAL SPREAD.
!       ------------------------------

        IF (GFLAG(33)) THEN
          iglobal=iglobal+1
          IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(33)))
     &     .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &     .OR.(.NOT.LMESSPASS)) THEN
            ilocal=ilocal+1
            IPARAM=228
            ITABLE=140
            CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WSPRDSG,
     &                    ITABLE, IPARAM, 0, 0 , 0,
     &                    CDATE, IFCST, MARSTYPE,
     &                    LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
          ENDIF
        ENDIF


! ----------------------------------------------------------------------

!*    6.  PACK SWELL WAVE TRAINS PARAMETERS INTO GRIB FM94.
!         ---------------------------------------------

      IF (GFLAG21.AND.CDTINTS.EQ.CDTPRO) THEN
        ITG=46
        IPARAM=120
        DO ITT=1,NTRAIN
!*        TRAIN WAVE HEIGHTS.
!         ---------------------
          ITG=ITG+1
          IPARAM=IPARAM+1
          IF (GFLAG(ITG)) THEN
            iglobal=iglobal+1
            IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &       .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &       .OR.(.NOT.LMESSPASS)) THEN
              ilocal=ilocal+1
              ITABLE=140
              CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WHGTTRG(:,:,ITT),
     &                      ITABLE, IPARAM, 0, 0 , 0,
     &                      CDATE, IFCST, MARSTYPE,
     &                      LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
            ENDIF
          ENDIF

!*        TRAIN WAVE DIRECTION.
!         ------------------------
          ITG=ITG+1
          IPARAM=IPARAM+1

          IF (GFLAG(ITG)) THEN
            iglobal=iglobal+1
            IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &       .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &       .OR.(.NOT.LMESSPASS)) THEN
              ilocal=ilocal+1
              ITABLE=140
              CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, WDIRTRG(:,:,ITT),
     &                      ITABLE, IPARAM, 0, 0 , 0,
     &                      CDATE, IFCST, MARSTYPE,
     &                      LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
            ENDIF
          ENDIF

!*        TRAIN WAVE PERIOD 
!         -----------------

          ITG=ITG+1
          IPARAM=IPARAM+1
          IF (GFLAG(ITG)) THEN
            iglobal=iglobal+1
            IF ((LMESSPASS.AND.LFDB.AND.(IRANK.EQ.IPFGTBL(ITG)))
     &       .OR.(LMESSPASS.AND.(.NOT.LFDB).AND.(IRANK.EQ.1))
     &       .OR.(.NOT.LMESSPASS)) THEN
              ilocal=ilocal+1
              ITABLE=140
              CALL WGRIBENOUT(IU06, ITEST, NGX, NGY, MWPMTRG(:,:,ITT),
     &                      ITABLE, IPARAM, 0, 0 , 0,
     &                      CDATE, IFCST, MARSTYPE,
     &                      LFDB, CFDBSF, KFDB, LFDBOPEN, IUOUT)
            ENDIF
          ENDIF

        ENDDO

      ENDIF

! ----------------------------------------------------------------------

      IF(LFDB.and.ILOCAL.gt.0) THEN
         IERR = ISETFIELDCOUNTFDBSUBS(KFDB,IGLOBAL,ILOCAL)
         IF(IERR.NE.0)THEN
            WRITE(IU06,*) ' ------------------------'
            WRITE(IU06,*) ' ERROR setting fdb field count '
            WRITE(IU06,*) ' in routine OUTINT '
            WRITE(IU06,*) ' FDB ERROR CODE IS ',IERR
            WRITE(IU06,*) ' ------------------------'
            CALL ABORT1
         ENDIF
      ENDIF

      IF(.NOT.LFDB) THEN
        IF (GFLAG20 .OR. GFLAG21) THEN
          CALL IGRIB_CLOSE_FILE(IUOUT)
        ENDIF
      ENDIF

#ifdef ECMWF
      IF (LHOOK) CALL DR_HOOK('OUTINT',1,ZHOOK_HANDLE)
#endif

      RETURN
      END SUBROUTINE OUTINT
