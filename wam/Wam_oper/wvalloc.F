      SUBROUTINE WVALLOC(LFDBOPIFS,LMESSPIFS,LDWCOUIFS,LDWCOU2W)

! ----------------------------------------------------------------------

!**** *WVALLOC* - WAVE MODEL ALLOCATION AND COUPLING TO IFS.

!     J. DOYLE     ECMWF       NOVEMBER 1996 ATMOSPHERIC COUPLING

!     MODIFIED BY:   B. HANSEN    APRIL 1997
!                                 DOCTOR STYLE AND LDWCOU2W

! ----------------------------------------------------------------------

      USE YOWCOUP  , ONLY : LWCOU    ,LWCOU2W
      USE YOWMEAN  , ONLY : EMEAN    ,FMEAN    ,THQ      ,AKMEAN   ,
     &            SMEAN
      USE YOWMESPAS, ONLY : LMESSPASS
      USE YOWMPP   , ONLY : IRANK    ,NPROC    ,NPREVIOUS,NNEXT    ,
     &            NINF     ,NSUP     ,MPMAXLENGTH
      USE YOWPARAM , ONLY : NANG     ,NFRE     ,NBLO     ,NIBLO
      USE YOWSPEC, ONLY : NSTART   ,NEND     ,KLENTOP  ,KLENBOT  ,
     &            U10NEW   ,U10OLD   ,THWNEW   ,THWOLD   ,USNEW    ,
     &            USOLD    ,Z0NEW    ,Z0OLD    ,TAUW     ,FCONST   ,
     &            FL1      ,FL2      ,FL3      ,SL

! ----------------------------------------------------------------------

      LOGICAL LFDBOPIFS,LMESSPIFS,LDWCOUIFS, LDWCOU2W
      LOGICAL LFDB

! INITIALIZE LOGICALS FROM IFS

      LFDB=LFDBOPIFS
      LMESSPASS=LMESSPIFS
      LWCOU=LDWCOUIFS
      LWCOU2W=LDWCOU2W


      IF(.NOT.ALLOCATED(NSTART)) THEN
        IF(LMESSPASS) THEN
          IU06=20
        ELSE
          IU06=6
        ENDIF

        IF(LMESSPASS) THEN

!     0.1 GET RANK AND TOTAL NUMBER OF PROCESSORS  
!         ---------------------------------------

          IRANK = MPE_MYRANK()
          NPROC = MPE_NPROC()
        ELSE
          IRANK = 1 
          NPROC = 1 
        ENDIF

        NPREVIOUS=IRANK-1
        IF(IRANK.EQ.NPROC) THEN
          NNEXT=0
        ELSE
          NNEXT=IRANK+1
        ENDIF

!     0.2 DETERMINE GRID DOMAIN DECOMPOSITION 
!         -----------------------------------
        ALLOCATE (NSTART(NPROC),NEND(NPROC),KLENBOT(NPROC),
     &            KLENTOP(NPROC))

        NPR=NPROC
        CALL MPDECOMP(NPR,NSTART,NEND,KLENTOP,KLENBOT,MAXLEN)
        MPMAXLENGTH=MAXLEN

      ENDIF

!     1.  ALLOCATE NECESSARY ARRAYS
!         -------------------------

      IF(.NOT.ALLOCATED(U10OLD)) ALLOCATE(U10OLD(NINF:NSUP,NBLO))
      IF(.NOT.ALLOCATED(THWOLD)) ALLOCATE(THWOLD(NINF:NSUP,NBLO))
      IF(.NOT.ALLOCATED(USOLD)) ALLOCATE(USOLD(NINF:NSUP,NBLO))
      IF(.NOT.ALLOCATED(Z0OLD)) ALLOCATE(Z0OLD(NINF:NSUP,NBLO))
      IF(.NOT.ALLOCATED(TAUW)) ALLOCATE(TAUW(NINF:NSUP,NBLO))
      IF(.NOT.ALLOCATED(U10NEW)) ALLOCATE(U10NEW(NINF:NSUP))
      IF(.NOT.ALLOCATED(THWNEW)) ALLOCATE(THWNEW(NINF:NSUP))
      IF(.NOT.ALLOCATED(USNEW)) ALLOCATE(USNEW(NINF:NSUP))
      IF(.NOT.ALLOCATED(Z0NEW)) ALLOCATE(Z0NEW(NINF:NSUP))

      IF(.NOT.ALLOCATED(FL1)) ALLOCATE(FL1(NINF-1:NSUP,NANG,NFRE))
      IF(.NOT.ALLOCATED(FL3)) ALLOCATE(FL3(NINF-1:NSUP,NANG,NFRE))

      IF(.NOT.LMESSPASS.AND..NOT.ALLOCATED(FL2))
     &   ALLOCATE(FL2(NINF-1:NSUP,NANG,NFRE))

      IF(.NOT.ALLOCATED(SL)) ALLOCATE(SL(NINF-1:NSUP,NANG,NFRE))
      IF(.NOT.ALLOCATED(FCONST)) ALLOCATE(FCONST(NINF:NSUP,NFRE))

      IF(.NOT.ALLOCATED(EMEAN)) ALLOCATE(EMEAN(NIBLO))
      IF(.NOT.ALLOCATED(FMEAN)) ALLOCATE(FMEAN(NIBLO))
      IF(.NOT.ALLOCATED(THQ)) ALLOCATE(THQ(NIBLO))
      IF(.NOT.ALLOCATED(AKMEAN)) ALLOCATE(AKMEAN(NINF:NSUP))
      IF(.NOT.ALLOCATED(SMEAN)) ALLOCATE(SMEAN(NIBLO))

      RETURN
      END SUBROUTINE WVALLOC
