      SUBROUTINE MBOUNF (IU03, IU10, IU20, IFORM, IINPC)

! ----------------------------------------------------------------------

!**** *MBOUNF* - MAKE FINE GRID BOUNDARY.

!     R. PORTZ     MPI         15/01/1991

!*    PURPOSE.
!     -------

!       COMPUTE ALL INFORMATION FOR FINE GRID BOUNDARY VALUE
!       INPUT (COMMON FBOUND).

!**   INTERFACE.
!     ----------

!       *CALL* *MBOUNF (IU03, IU10, IU20, IFORM, IINPC)
!          *IU03*  -  INPUT UNIT OF COARSE GRID BOUNDARY INFORMATION
!                     COMMON CBOUND GENERATED BY A COARSE GRID PREPROC
!                     (UNFORMATED).
!          *IU10*   - LOGICAL OUTPUT UNIT FOR  UNFORMATED WRITE OF
!                     COMMON FBOUND.
!          *IU20*   - LOGICAL OUTPUT UNIT FOR    FORMATED WRITE OF
!                     COMMON FBOUND.
!          *IFORM*  - FORMAT OPTION  = 1  UNFORMATED WRITE/READ.
!                                    = 2  FORMATED WRITE/READ
!                                    OTHERWISE WRITE BOTH
!                                              READ UNFORMATED.
!          *IINPC*  - NUMBER OF INPUT POINTS FROM COARSE GRID.

!     METHOD.
!     -------

!       NONE.

!     EXTERNALS.
!     ----------

!       *ABORT1*     - TERMINATES PROCESSING.
!       *FINDB*     - FIND BLOCK AND SEA POINT NUMBERS.
!       *MBOXB*     - FIND LAT AND LONG OF BOUNDARY POINTS.
!       *MINTF*     - MAKES INTERPOLATION TABLE FOR FINE TO COARSE GRID.
!       *PACKI*     - PACKS AN INTEGER ARRAY.
!       *PACKC*     - PACKS A  REAL    ARRAY.

!     REFERENCE.
!     ----------

!       NONE.

! ----------------------------------------------------------------------

      USE YOWPARAM , ONLY : NGX      ,NGY
      USE YOWCPBO  , ONLY : NBOUNC   ,IJARC    ,IGARC    ,DLAMAC   ,
     &            DPHIAC   ,BLATC    ,BLNGC
      USE YOWFPBO  , ONLY : NBOUNF   ,IJARF    ,IGARF    ,IBFL     ,
     &            IBFR     ,BFW
      USE YOWMAP   , ONLY : AMOWEP   ,AMOSOP   ,AMOEAP   ,AMONOP   ,
     &            XDELLA   ,XDELLO
      USE YOWPRPROC,ONLY : NBMAX
      USE YOWTEST  , ONLY : IU06

! ----------------------------------------------------------------------

      REAL, ALLOCATABLE :: BLATF(:), BLNGF(:)

! ----------------------------------------------------------------------

  998 FORMAT(10I8)
  999 FORMAT(5E16.7)

! ----------------------------------------------------------------------

!*    1. INITIAL.
!     -----------

      NBMAX = (NGX+NGY)*2-4

      ALLOCATE(IJARF(NBMAX))
      ALLOCATE(IGARF(NBMAX))
      ALLOCATE(IBFL(NBMAX))
      ALLOCATE(IBFR(NBMAX))
      ALLOCATE(BFW(NBMAX))
      ALLOCATE(BLATF(NBMAX))
      ALLOCATE(BLNGF(NBMAX))

      DO I = 1,NBMAX
        IJARF(I) = 0
        IGARF(I) = 0
        IBFL (I) = 0
        IBFR (I) = 0
        BFW  (I) = 0.
        BLATF(I) = 0.
        BLNGF(I) = 0.
      ENDDO

! ----------------------------------------------------------------------

!*    2. READ COMMON BOUNDC
!     ---------------------

      IF (IFORM.NE.2) THEN
        READ (IU03) NBOUNC
        READ (IU03) (IGARC(I),I=1,NBOUNC), (IJARC(I),I=1,NBOUNC)
        READ (IU03) DLAMAC, DPHIAC, AMOSOA, AMONOA, AMOEAA, AMOWEA,
     &   (BLNGC(I),I=1,NBOUNC), (BLATC(I),I=1,NBOUNC)
      ELSE
        READ (IU03,998) NBOUNC
        READ (IU03,998) (IGARC(I),I=1,NBOUNC), (IJARC(I),I=1,NBOUNC)
        READ (IU03,999) DLAMAC,DPHIAC, AMOSOA, AMONOA, AMOEAA, AMOWEA,
     &   (BLNGC(I),I=1,NBOUNC), (BLATC(I),I=1,NBOUNC)
      ENDIF
      IINPC = NBOUNC

! ----------------------------------------------------------------------

!*    3. CHECK THE INPUT
!     ------------------

!     IS THE FINE GRID THE SAME AS IN THE COURSE GRID ?

      IF (AMOWEP.NE.AMOWEA .OR. AMOEAP.NE.AMOEAA .OR.
     &    AMONOP.NE.AMONOA .OR. AMOSOP.NE.AMOSOA) THEN
        WRITE(IU06,*) '***********************************'
        WRITE(IU06,*) '*                                 *'
        WRITE(IU06,*) '*  FATAL ERROR IN SUB. MBOUNF     *'
        WRITE(IU06,*) '*  ==========================     *'
        WRITE(IU06,*) '*                                 *'
        WRITE(IU06,*) '*  THIS IS NOT THE SAME GRID      *'
        WRITE(IU06,*) '*  AS YOU HAD DELARED IN THE      *'
        WRITE(IU06,*) '*  COURSE GRID                    *'
        WRITE(IU06,*) '*                                 *'
        WRITE(IU06,*) '*  AMOSOP: ', AMOSOP, ' AMOSOA: ', AMOSOA
        WRITE(IU06,*) '*  AMONOP: ', AMONOP, ' AMONOA: ', AMONOA
        WRITE(IU06,*) '*  AMOWEP: ', AMOWEP, ' AMOWEA: ', AMOWEA
        WRITE(IU06,*) '*  AMOEAP: ', AMOEAP, ' AMOEAA: ', AMOEAA
        WRITE(IU06,*) '*                                 *'
        WRITE(IU06,*) '*     THE PROGRAM ABORTS          *'
        WRITE(IU06,*) '***********************************'
        CALL ABORT1
      ENDIF

!     IS THE STEP OF LAT. AND LONG. OF THE FINE GRID A MULTIPLE
!              OF THE COURSE GRID ?

      IF (MOD(DPHIAC,XDELLA).NE.0.) THEN
        WRITE(IU06,*) '***********************************'
        WRITE(IU06,*) '*                                 *'
        WRITE(IU06,*) '*  FATAL ERROR IN SUB. MBOUNF     *'
        WRITE(IU06,*) '*  --------------------------     *'
        WRITE(IU06,*) '*                                 *'
        WRITE(IU06,*) '*  THE STEP OF THE LAT. OF THE    *'
        WRITE(IU06,*) '*  FINE GRID IS NOT A MULTIPLE    *'
        WRITE(IU06,*) '*  OF THE COURSE GRID             *'
        WRITE(IU06,*) '*                                 *'
        WRITE(IU06,*) '*  FINE GRID XDELLA: ', XDELLA
        WRITE(IU06,*) '*  COARSE GRID DPHIAC: ', DPHIAC
        WRITE(IU06,*) '*                                 *'
        WRITE(IU06,*) '*     THE PROGRAM ABORTS          *'
        WRITE(IU06,*) '***********************************'
        CALL ABORT1
      ENDIF

      IF (MOD(DLAMAC,XDELLO).NE.0.) THEN
        WRITE(IU06,*) '***********************************'
        WRITE(IU06,*) '*                                 *'
        WRITE(IU06,*) '*  FATAL ERROR IN SUB. MBOUNF     *'
        WRITE(IU06,*) '*  ==========================     *'
        WRITE(IU06,*) '*                                 *'
        WRITE(IU06,*) '*  THE STEP OF THE LON. OF THE    *'
        WRITE(IU06,*) '*  FINE GRID IS NOT A MULTIPLE    *'
        WRITE(IU06,*) '*  OF THE COURSE GRID             *'
        WRITE(IU06,*) '*                                 *'
        WRITE(IU06,*) '*  FINE GRID   XDELLO: ', XDELLO
        WRITE(IU06,*) '*  COARSE GRID DLAMAC: ', DLAMAC
        WRITE(IU06,*) '*                                 *'
        WRITE(IU06,*) '*     THE PROGRAM ABORTS          *'
        WRITE(IU06,*) '***********************************'
        CALL ABORT1
      ENDIF

! ----------------------------------------------------------------------

!*    4. COMPUTED THE SQUARE BOX
!     --------------------------

      CALL MBOXB (NBOUNF, AMOWEP, AMOSOP, AMOEAP, AMONOP, BLATF, BLNGF)

! ----------------------------------------------------------------------

!*    5. SEARCH BLOCK NUMBER AND SEA POINT NUMBER.
!        -----------------------------------------
      CALL FINDB (NBMAX, NBOUNF, BLATF, BLNGF, IGARF, IJARF)

! ----------------------------------------------------------------------

!*    6. MAKE INTERPOLATED ARRAYS
!     ----------------------------

      CALL MINTF

! ----------------------------------------------------------------------

!*    7. PACKED ALL ARRAYS
!     --------------------

      CALL PACKR (NBOUNF, NBOUNEW, NBMAX, IGARF, BLNGF)
      CALL PACKR (NBOUNF, NBOUNEW, NBMAX, IGARF, BLATF)
      CALL PACKR (NBOUNF, NBOUNEW, NBMAX, IGARF, BFW)
      CALL PACKI (NBOUNF, NBOUNEW, NBMAX, IGARF, IBFR)
      CALL PACKI (NBOUNF, NBOUNEW, NBMAX, IGARF, IJARF)
      CALL PACKI (NBOUNF, NBOUNEW, NBMAX, IGARF, IGARF)
      NBOUNF = NBOUNEW

! ----------------------------------------------------------------------

!*    8. PRINTER PROTOCOL.
!        -----------------

      WRITE (IU06,'(''1BOUNDARY INPUT POINTS FOR THIS GRID:'')')
      WRITE (IU06,*) '===================================='
      WRITE (IU06,*) '  NUMBER OF BOUNDARY POINTS IS NBOUNF = ', NBOUNF
      WRITE (IU06,*) '        |-----FINE GRID INPUT POINTS-----|',
     &              '-RELATED COURSE GRID INDICES--|'
      WRITE (IU06,*) '      NO.    LAT.   LONG.  BLOCK.  POINT. ',
     &              '   LEFT   RIGHT   WEIGHT '

      DO IO = 1, NBOUNF
        WRITE (IU06,'(4X,I5,2F8.2,4I8,F10.4)')
     &   IO, BLATF(IO), BLNGF(IO), IGARF(IO), IJARF(IO),
     &   IBFL(IO), IBFR(IO), BFW(IO)
      ENDDO

! ----------------------------------------------------------------------

!*    9. WRITE COMMON FBOUND

      IF (IFORM.NE.2) THEN
        WRITE(IU10) NBOUNF
        WRITE(IU10) (IGARF(I),I=1,NBOUNF), (IJARF(I),I=1,NBOUNF),
     &   (IBFL(I),I=1,NBOUNF), (IBFR(I),I=1,NBOUNF),
     &   (BFW(I),I=1,NBOUNF)
      ENDIF
      IF (IFORM.NE.1) THEN
        WRITE(IU20,998) NBOUNF
        WRITE(IU20,998) (IGARF(I),I=1,NBOUNF), (IJARF(I),I=1,NBOUNF),
     &   (IBFL(I),I=1,NBOUNF), (IBFR(I),I=1,NBOUNF)
        WRITE(IU20,999) (BFW(I),I=1,NBOUNF)
      ENDIF

      RETURN
      END SUBROUTINE MBOUNF
